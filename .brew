#!/usr/bin/env bash

export HOMEBREW_NO_ANALYTICS=1
export HOMEBREW_NO_INSECURE_REDIRECT=1

brew() {
  "$HOME/.homebrew/bin/brew" "$@"
}

echo "--> Make sure we're using the latest Homebrew"
brew update

echo '--> Upgrade any already-installed formulae'
brew upgrade

echo '--> Tap extras Homebrew repositories'
brew tap Goles/battery
brew tap caskroom/fonts
brew tap caskroom/versions
brew tap homebrew/binary
brew tap homebrew/devel-only
brew tap homebrew/dupes
brew tap homebrew/services
brew tap homebrew/versions
brew tap jeffreywildman/homebrew-virt-manager
brew tap thoughtbot/formulae
brew tap tldr-pages/tldr

echo '--> Install all brew Packages'
brew install ack
brew install advancecomp
brew install ansifilter
brew install autoenv
brew install awscli
brew install bash
brew install bats
brew install battery
brew install cheat
brew install chruby
brew install cli53
brew install cloc
brew install closure-compiler
brew install coreutils
brew install ctags
brew install curl --with-openssl && brew link --force curl
brew install dnscrypt-proxy --with-plugins
brew install dnsmasq
brew install docker
brew install docker-compose
brew install docker-machine
brew install entr
brew install ffmpeg
brew install findutils
brew install fzf
brew install ghi
brew install gifsicle
brew install git
brew install gnu-sed --with-default-names
brew install gnu-tar
brew install go
brew install gpg
brew install graphviz
brew install gsl
brew install hadolint
brew install htmlcompressor --yuicompressor
brew install htop-osx
brew install hub
brew install imagemagick --with-webp
brew install ipcalc
brew install jhead
brew install jpeg
brew install jpegoptim
brew install jq
brew install keybase
brew install lesspipe
brew install macvim --with-cscope --with-override-system-vim --with-custom-icons
brew install moreutils
brew install nodejs
brew install openssl && brew link openssl --force
brew install optipng
brew install packer
brew install pandoc
brew install pigz
brew install pngcrush
brew install pngquant
brew install pre-commit
brew install pv
brew install pwgen
brew install python --with-brewed-openssl
brew install python3 --with-brewed-openssl
brew install readline
brew install reattach-to-user-namespace
brew install ruby-build
brew install ruby-install
brew install s3cmd
brew install shellcheck
brew install shpotify
brew install spark
brew install ssh-copy-id
brew install sshrc
brew install stow
brew install tcpdump
brew install terminal-notifier
brew install terraform
brew install the_silver_searcher
brew install tig
brew install tldr
brew install tmux
brew install tree
brew install v
brew install virt-manager
brew install virt-viewer
brew install watch
brew install webkit2png
brew install wget
brew install xz
brew install z
brew install zsh
brew install zsh-syntax-highlighting

# login as admin to install all casks system-wide in /Applications
su admin -c "
while true; do sudo -n true; sleep 60; kill -0 $$ || exit; done 2>/dev/null &

echo '--> Install/update Homebrew cask'

brew cask install 1password
brew cask install dropbox
brew cask install flux
brew cask install font-hack
brew cask install gimp
brew cask install google-drive
brew cask install google-photos-backup
brew cask install gpgtools
brew cask install hipchat
brew cask install imageoptim
brew cask install java6
brew cask install java7
brew cask install movelinks
brew cask install omnigraffle
brew cask install sequel-pro
brew cask install spectacle
brew cask install spotify
brew cask install tunnelbear
brew cask install vagrant
brew cask install virtualbox
brew cask install vlc
brew cask install whatsapp
brew cask install xquartz
brew cask install iterm2
brew cask install firefox
brew cask install google-chrome

brew cask cleanup
"

## node.js
npm install -g js-yaml csslint

## python
PIPS=(
  fabric
  flake8
  howdoi
  httpie
  jungle
  pylint
  virtualenv
)

"$(brew --prefix)/bin/pip" install --upgrade pip

for pip in "${PIPS[@]}"; do
  "$(brew --prefix)/bin/pip" list -l | grep "$pip" &>/dev/null || \
    "$(brew --prefix)/bin/pip" install "$pip"
done

## ruby
mkdir -p "${HOME}/.rubies"

RUBIES=(
  2.2.6
  2.3.3
)

for ruby in "${RUBIES[@]}"; do
  if [[ ! -f "${HOME}/.rubies/ruby-${ruby}/bin/ruby" ]]; then
    "$(brew --prefix)/bin/ruby-build" "$ruby" "${HOME}/.rubies/ruby-${ruby}"
  fi
done

echo "${RUBIES[@]:(-1)}" > ~/.ruby-version

GEMS=(
  bundler
  hue
  kitchen-vagrant
  puppet-lint
  rubocop
  shell_explain
  tmuxinator
)

# shellcheck source=/dev/null
source "$(brew --prefix)/share/chruby/chruby.sh"
chruby "$(cat "${HOME}/.ruby-version")"

for gem in "${GEMS[@]}"; do
  gem list -i "${gem}" &>/dev/null || gem install "${gem}"
done

gem ctags
for ruby in ~/.rubies/*/lib/ruby/; do
  pushd "${ruby}" &> /dev/null
    ctags -R ./*
  popd &> /dev/null
done

gem pristine --all
