#!/usr/bin/env bash
# https://github.com/Russell91/sshrc

set -o vi

SHELL="$(which bash)"
export SHELL

readonly TMUXDIR='/tmp/.bdossantos'
readonly TMUXSERVER="${TMUXDIR}/tmux"

tmuxrc() {
  if [[ ! -d $TMUXDIR ]]; then
    rm -rf "$TMUXDIR"
    mkdir -p "$TMUXDIR"
  fi

  cp -rf \
    "${SSHHOME}/.sshrc" \
    "${SSHHOME}/bashsshrc" \
    "${SSHHOME}/sshrc" \
    "${SSHHOME}/.sshrc.d/" \
    "$TMUXDIR"

  SSHHOME="$TMUXDIR" SHELL="${TMUXDIR}/bashsshrc" tmux -S "$TMUXSERVER" "$@"
}

# load system-wide profile.d if needed
if [[ -d /etc/profile.d ]]; then
  for i in /etc/profile.d/*.sh; do
    # shellcheck source=/dev/null
    [[ -r "$i" ]] && source "$i"
  done
  unset i
fi

# Aliases
# shellcheck source=/dev/null
[[ -f "$SSHHOME/.sshrc.d/.aliases" ]] && source "$SSHHOME/.sshrc.d/.aliases"

# Tmux on startup
if [[ -r "$TMUXSERVER" ]]; then
  [[ -z "$TMUX" ]] && tmux -S "$TMUXSERVER" attach || tmux -S "$TMUXSERVER"
fi
